<!doctype html>
<html lang="fi">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Kello ja Päivämäärä</title>
  <style>
    :root{
      --bg: #ffffff;
      --fg: #111111;
      --card: #f5f5f5;
      --accent: #0b5cff;
    }
    .dark{ --bg:#0b0b0f; --fg:#f2f2f7; --card:#141419; --accent:#5aa0ff }
    html,body{height:100%; margin:0; font-family:system-ui,-apple-system,"Segoe UI",Roboto, "Helvetica Neue", Arial; background:var(--bg); color:var(--fg)}
    .wrap{max-width:980px; margin:24px auto; padding:18px; display:grid; grid-template-columns: 1fr 320px; gap:18px; align-items:start}
    header{grid-column:1/-1; display:flex; gap:12px; align-items:center}
    h1{font-size:1.6rem; margin:0}
    .card{background:var(--card); padding:18px; border-radius:14px; box-shadow: 0 6px 18px rgba(0,0,0,0.06)}
    /* Analog clock */
    .analog{display:flex; flex-direction:column; gap:12px; align-items:center}
    canvas{width:300px; height:300px; touch-action:none}
    /* Digital */
    .digital{display:flex; flex-direction:column; gap:8px; align-items:center}
    .time-big{font-size:3.6rem; font-weight:700; letter-spacing:1px}
    .date-big{font-size:1.4rem}
    .words{font-size:1.2rem}
    /* Controls */
    .controls{display:flex; gap:8px; margin-left:auto}
    button{background:transparent;border:1px solid rgba(0,0,0,0.08); padding:8px 12px; border-radius:10px; cursor:pointer}
    .small{font-size:0.9rem}
    /* Responsive */
    @media (max-width:880px){
      .wrap{grid-template-columns:1fr; padding:12px}
      canvas{width:260px;height:260px}
    }
    /* Very large text mode (for patients) */
    .bigtext .time-big{font-size:5.2rem}
    .bigtext .date-big{font-size:2rem}
    .bigtext .words{font-size:1.6rem}
  </style>
</head>
<body>
  <div class="wrap" id="app">
    <header>
      <h1>Kello ja päivämäärä</h1>
      <div class="controls">
        <button id="toggleSize" class="small">Suurenna tekstiä</button>
        <button id="toggleTheme" class="small">Tumma tila</button>
        <button id="speak" class="small">Sano aika</button>
      </div>
    </header>

    <section class="card analog">
      <canvas id="analog" width="600" height="600" aria-label="Analoginen kello"></canvas>
      <div class="words" id="spokenTime" aria-live="polite"></div>
    </section>

    <aside class="card digital">
      <div class="time-big" id="digital" aria-live="polite">--:--:--</div>
      <div class="date-big" id="date">---</div>
      <div class="words" id="natural">--</div>
    </aside>
  </div>

  <script>
    // --- Localization (Finnish) ---
    const WEEKDAYS = ['sunnuntai','maanantai','tiistai','keskiviikko','torstai','perjantai','lauantai'];
    const MONTHS = ['tammikuuta','helmikuuta','maaliskuuta','huhtikuuta','toukokuuta','kesäkuuta','heinäkuuta','elokuuta','syyskuuta','lokakuuta','marraskuuta','joulukuuta'];

    // --- Elements ---
    const analog = document.getElementById('analog');
    const ctx = analog.getContext('2d');
    const digital = document.getElementById('digital');
    const dateEl = document.getElementById('date');
    const natural = document.getElementById('natural');
    const spokenTime = document.getElementById('spokenTime');
    const toggleSize = document.getElementById('toggleSize');
    const toggleTheme = document.getElementById('toggleTheme');
    const speakBtn = document.getElementById('speak');
    const app = document.getElementById('app');

    // --- Dark mode by time and system preference ---
    function applyTheme(dark){
      document.documentElement.classList.toggle('dark', dark);
      toggleTheme.textContent = dark ? 'Vaalea tila' : 'Tumma tila';
    }
    // Use system preference but override by night hours (21-07)
    function detectAndApplyTheme(){
      const hour = new Date().getHours();
      const night = (hour >= 21 || hour < 7);
      const prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
      applyTheme(night || prefersDark);
    }
    detectAndApplyTheme();
    // allow manual toggle
    toggleTheme.addEventListener('click', ()=>{
      const isDark = document.documentElement.classList.toggle('dark');
      // update text
      toggleTheme.textContent = isDark ? 'Vaalea tila' : 'Tumma tila';
    });

    // --- Size toggle ---
    let big = false;
    toggleSize.addEventListener('click', ()=>{
      big = !big;
      document.body.classList.toggle('bigtext', big);
      toggleSize.textContent = big ? 'Pienennä tekstiä' : 'Suurenna tekstiä';
    });

    // --- Speech ---
    speakBtn.addEventListener('click', ()=>{
      const t = natural.textContent || digital.textContent;
      if('speechSynthesis' in window){
        const u = new SpeechSynthesisUtterance(t);
        u.lang = 'fi-FI';
        speechSynthesis.cancel();
        speechSynthesis.speak(u);
      } else alert('Puhetta ei tueta tässä selaimessa.');
    });

    // --- Utilities ---
    function pad(n){ return n.toString().padStart(2,'0'); }

    // Returns Finnish natural-language time like "varttia vaille kuusi", "kello kaksitoista yli viisitoista"
    function naturalFinnish(h,m){
      // round to nearest 5 minutes for natural phrasing
      const r = Math.round(m/5)*5 % 60;
      let hour = h;
      let phrase = '';
      if(r === 0){
        phrase = `kello ${numberToWords(hour)} ihan`;
      } else if(r === 15){
        phrase = `vartin yli ${numberToWords(hour)}`;
      } else if(r === 30){
        phrase = `puoli ${numberToWords((hour%12)+1)}`;
      } else if(r === 45){
        phrase = `varttia vaille ${numberToWords((hour%12)+1)}`;
      } else if(r < 30){
        phrase = `${r} yli ${numberToWords(hour)}`;
      } else {
        const minutesTo = 60 - r;
        phrase = `${minutesTo} vaille ${numberToWords((hour%12)+1)}`;
      }
      return phrase;
    }

    // convert small numbers to finnish words (1-12 mostly used)
    function numberToWords(n){
      const MAP = ['kaksitoista','yksi','kaksi','kolme','neljä','viisi','kuusi','seitsemän','kahdeksan','yhdeksän','kymmenen','yksitoista','kaksitoista'];
      // We'll map 1..12 properly
      const words = {1:'yksi',2:'kaksi',3:'kolme',4:'neljä',5:'viisi',6:'kuusi',7:'seitsemän',8:'kahdeksan',9:'yhdeksän',10:'kymmenen',11:'yksitoista',12:'kaksitoista'};
      const mod = ((n%12)+12)%12 || 12;
      return words[mod] || String(n);
    }

    // --- Update display ---
    function update(){
      const now = new Date();
      const h = now.getHours();
      const m = now.getMinutes();
      const s = now.getSeconds();

      digital.textContent = `${pad(h)}:${pad(m)}:${pad(s)}`;
      const wd = WEEKDAYS[now.getDay()];
      const day = now.getDate();
      const month = MONTHS[now.getMonth()];
      const year = now.getFullYear();
      dateEl.textContent = `${wd}, ${day}. ${month} ${year}`;

      // natural phrasing
      natural.textContent = naturalFinnish(h,m);
      spokenTime.textContent = `Kellonaika: ${h}:${pad(m)}`;

      drawAnalog(h,m,s);
    }

    // --- Analog clock drawing ---
    const DPR = window.devicePixelRatio || 1;
    function resizeCanvas(){
      const styleW = analog.clientWidth;
      const styleH = analog.clientHeight;
      analog.width = Math.round(styleW * DPR);
      analog.height = Math.round(styleH * DPR);
      ctx.setTransform(DPR,0,0,DPR,0,0);
    }
    window.addEventListener('resize', resizeCanvas);
    resizeCanvas();

    function drawAnalog(hours,minutes,seconds){
      const w = analog.width / DPR;
      const h = analog.height / DPR;
      const cx = w/2; const cy = h/2; const r = Math.min(cx,cy) - 10;
      ctx.clearRect(0,0,w,h);

      // face
      ctx.beginPath(); ctx.arc(cx,cy,r,0,Math.PI*2); ctx.fillStyle = getComputedStyle(document.documentElement).getPropertyValue('--card'); ctx.fill();
      // ticks
      for(let i=0;i<60;i++){
        const angle = i * Math.PI/30;
        const inner = r - (i%5===0 ? 18 : 10);
        const x1 = cx + Math.cos(angle) * inner;
        const y1 = cy + Math.sin(angle) * inner;
        const x2 = cx + Math.cos(angle) * r;
        const y2 = cy + Math.sin(angle) * r;
        ctx.beginPath(); ctx.moveTo(x1,y1); ctx.lineTo(x2,y2); ctx.lineWidth = (i%5===0?3:1.2); ctx.strokeStyle = getComputedStyle(document.documentElement).getPropertyValue('--fg'); ctx.stroke();
      }

      // hour hand
      const hourAngle = ((hours%12) + minutes/60 + seconds/3600) * Math.PI/6 - Math.PI/2;
      drawHand(hourAngle, r*0.5, 7);
      // minute
      const minuteAngle = (minutes + seconds/60) * Math.PI/30 - Math.PI/2;
      drawHand(minuteAngle, r*0.72, 5);
      // second
      const secondAngle = seconds * Math.PI/30 - Math.PI/2;
      drawHand(secondAngle, r*0.86, 2, true);

      // center
      ctx.beginPath(); ctx.arc(cx,cy,6,0,Math.PI*2); ctx.fillStyle = getComputedStyle(document.documentElement).getPropertyValue('--accent'); ctx.fill();

      function drawHand(angle,length,linewidth,isSecond){
        ctx.beginPath(); ctx.lineWidth = linewidth; ctx.lineCap='round';
        ctx.moveTo(cx,cy);
        ctx.lineTo(cx + Math.cos(angle)*length, cy + Math.sin(angle)*length);
        ctx.strokeStyle = isSecond ? getComputedStyle(document.documentElement).getPropertyValue('--accent') : getComputedStyle(document.documentElement).getPropertyValue('--fg');
        ctx.stroke();
      }
    }

    // start update loop
    setInterval(update, 1000);
    update();

    // Also update theme every 5 minutes in case time passes into night
    setInterval(detectAndApplyTheme, 5*60*1000);

    // Accessibility: keyboard shortcuts
    document.addEventListener('keydown', (e)=>{
      if(e.key === 't') toggleTheme.click();
      if(e.key === 's') speakBtn.click();
      if(e.key === '+') toggleSize.click();
    });

    // initial spoken hint
    spokenTime.textContent = 'Paina "Sano aika" -painiketta kuullaksesi ajan.';
  </script>
</body>
</html>
